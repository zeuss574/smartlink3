<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="icon" href="<%= thumbnailUrl %>">

    <!-- Theme Color for Browser Chrome -->
    <meta name="theme-color" content="#141414">

    <style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-surface: rgba(20, 20, 20, 0.75);
        }

        html {
            /* Remove scroll locking */
            overscroll-behavior-y: auto; 
            min-height: 100%;
            /* IMPORTANT: Transparent so overscroll reveals fixed bg */
            background-color: transparent; 
        }

        body { 
            font-family: 'Inter', sans-serif; 
            /* IMPORTANT: Transparent background ensures seamless bounce */
            background-color: transparent; 
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            min-height: 100vh;
            color: white;
        }

        /* Optimized Glass */
        .ios-glass {
            background: var(--glass-surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateZ(0);
        }

        /* Optimized List Button */
        .glass-button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease, background 0.2s ease;
            position: relative;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.01);
        }

        .glass-button:active {
            transform: scale(0.99);
        }

        /* Fade In */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
            will-change: transform, opacity;
        }
        
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Static Background Blur */
        .bg-static-blur {
            filter: blur(60px);
            transform: translateZ(0);
        }

        /* Scrollbar aesthetics */
        .legal-content::-webkit-scrollbar { width: 4px; }
        .legal-content::-webkit-scrollbar-track { background: transparent; }
        .legal-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col items-center justify-center py-12">

    <!-- Background Layer (Fixed & Behind Everything) -->
    <!-- z-index: -1 ensures it stays put while body bounces over it -->
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none bg-black">
        <!-- Static Blurred Background -->
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 bg-static-blur"
             style="background-image: url('<%= thumbnailUrl %>');">
        </div>
        <!-- Gradient overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/40 to-black/80"></div>
    </div>

    <!-- Floating Cookie Orb -->
    <button onclick="toggleModal('cookie-modal')" class="fixed bottom-6 left-6 z-40 w-12 h-12 ios-glass rounded-full flex items-center justify-center text-white/80 hover:text-white transition-transform active:scale-95 cursor-pointer shadow-lg" aria-label="Legal & Cookies">
        <i class="fas fa-cookie text-lg"></i>
    </button>

    <!-- Main Card -->
    <main class="relative z-10 w-full max-w-[400px] mx-auto px-4 fade-in-up">
        
        <div class="ios-glass rounded-[32px] flex flex-col overflow-hidden relative">
            
            <!-- Header Section -->
            <div class="pt-10 pb-6 flex flex-col items-center text-center relative z-10">
                <!-- Album Art -->
                <div class="relative w-48 h-48 mb-6">
                    <img src="<%= thumbnailUrl %>" 
                         alt="Album Art" 
                         class="w-full h-full object-cover rounded-[16px] shadow-2xl border border-white/10"
                         loading="eager">
                </div>

                <!-- Title Info -->
                <div class="px-6">
                    <h1 class="text-2xl font-bold text-white mb-1 tracking-tight"><%= title %></h1>
                    <p class="text-sm text-white/60 font-medium tracking-wide uppercase">Choose Service</p>
                </div>
            </div>

            <!-- Service List Container -->
            <div class="px-4 pb-6 space-y-3 relative z-10">
                <% 
                let allPlatformKeys = Object.keys(links);
                allPlatformKeys.sort((a, b) => {
                    const indexA = preferredOrder.indexOf(a);
                    const indexB = preferredOrder.indexOf(b);
                    if (indexA !== -1 && indexB !== -1) return indexA - indexB;
                    if (indexB !== -1) return 1;
                    if (indexA !== -1) return -1;
                    const displayNameA = platformDisplayInfo[a] ? platformDisplayInfo[a].displayName : formatPlatformName(a);
                    const displayNameB = platformDisplayInfo[b] ? platformDisplayInfo[b].displayName : formatPlatformName(b);
                    return displayNameA.localeCompare(displayNameB);
                });

                allPlatformKeys.forEach(platformKey => {
                    const link = links[platformKey];
                    const info = platformDisplayInfo[platformKey];
                    const iconSlug = info ? info.iconSlug : platformKey.toLowerCase();
                    const displayName = info ? info.displayName : formatPlatformName(platformKey);
                %>
                    <a href="<%= link.url %>" target="_blank" class="glass-button rounded-[16px] flex items-center justify-between p-3.5 group">
                        <div class="flex items-center gap-4 min-w-0">
                            <!-- Logo Container -->
                            <div class="w-9 h-9 flex items-center justify-center rounded-full bg-white/10 shrink-0">
                                <% if (info && info.iconUrl) { %>
                                    <img src="<%= info.iconUrl %>" alt="<%= displayName %>" class="w-5 h-5 object-contain" loading="lazy">
                                <% } else if (platformKey === 'amazonStore') { %>
                                    <img src="https://services.linkfire.com/logo_amazon_onlight.svg" alt="Amazon" class="w-5 h-5 object-contain" loading="lazy">
                                <% } else if (platformKey === 'boomplay') { %>
                                    <img src="https://assets.ffm.to/images/logo/music-service_boomplay_updated.png" alt="Boomplay" class="w-5 h-5 object-contain" loading="lazy">
                                <% } else { %>
                                    <img src="https://services.linkfire.com/logo_<%= iconSlug %>_onlight.svg" onerror="this.style.display='none'" alt="<%= displayName %>" class="w-5 h-5 object-contain" loading="lazy">
                                <% } %>
                            </div>
                            <span class="font-semibold text-white/90 text-[15px] truncate"><%= displayName %></span>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="w-8 h-8 flex items-center justify-center text-white/40 shrink-0">
                            <i class="fas fa-chevron-right text-sm"></i>
                        </div>
                    </a>
                <% }); %>
            </div>
        </div>
    </main>

    <!-- Cookie Modal -->
    <div id="cookie-modal" class="fixed inset-0 z-50 flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('cookie-modal')"></div>
        <div class="ios-glass p-8 rounded-[24px] max-w-xs w-full relative z-10 transform scale-95 translate-y-4 transition-transform duration-300 modal-content bg-[#111]">
            <div class="text-center">
                <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-5 text-white">
                    <i class="fas fa-cookie text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Privacy & Data</h3>
                <p class="text-sm text-white/60 mb-6 leading-relaxed">
                    We use cookies to ensure the best experience. By continuing, you agree to our standard terms.
                </p>
                <button onclick="toggleModal('cookie-modal')" class="w-full py-3 px-6 bg-white text-black font-bold text-sm rounded-full hover:bg-gray-200 transition-colors mb-4">
                    Accept All
                </button>
                <div class="flex justify-center gap-4 text-[11px] text-white/40 font-medium uppercase tracking-widest">
                    <button onclick="switchModal('cookie-modal', 'privacy-modal')" class="hover:text-white transition-colors">Privacy</button>
                    <span>â€¢</span>
                    <button onclick="switchModal('cookie-modal', 'terms-modal')" class="hover:text-white transition-colors">Terms</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div id="privacy-modal" class="fixed inset-0 z-[60] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('privacy-modal')"></div>
        <div class="ios-glass p-6 rounded-[24px] max-w-md w-full relative z-10 transform scale-95 translate-y-4 transition-transform duration-300 flex flex-col max-h-[80vh] modal-content bg-[#111]">
            <div class="flex items-center justify-between mb-4 border-b border-white/10 pb-4">
                <h3 class="text-lg font-bold text-white">Privacy Policy</h3>
                <button onclick="toggleModal('privacy-modal')" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-times text-white text-sm"></i>
                </button>
            </div>
            <div class="legal-content overflow-y-auto text-left space-y-4 text-white/70 text-sm pr-2">
                <p><strong>Last updated: October 2024</strong></p>
                <p>This Privacy Policy describes Our policies and procedures on the collection, use and disclosure of Your information.</p>
                <h4 class="text-white font-semibold mt-4">1. Data Collection</h4>
                <p>We collect Usage Data automatically when using the Service. This may include IP addresses and browser types.</p>
                <h4 class="text-white font-semibold mt-4">2. Cookies</h4>
                <p>We use Cookies to track activity on Our Service and store certain information to improve functionality.</p>
            </div>
            <div class="mt-6 pt-4 border-t border-white/10 text-center">
                <button onclick="switchModal('privacy-modal', 'cookie-modal')" class="text-xs text-white/50 hover:text-white uppercase tracking-wider">Back</button>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="terms-modal" class="fixed inset-0 z-[60] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('terms-modal')"></div>
        <div class="ios-glass p-6 rounded-[24px] max-w-md w-full relative z-10 transform scale-95 translate-y-4 transition-transform duration-300 flex flex-col max-h-[80vh] modal-content bg-[#111]">
            <div class="flex items-center justify-between mb-4 border-b border-white/10 pb-4">
                <h3 class="text-lg font-bold text-white">Terms of Service</h3>
                <button onclick="toggleModal('terms-modal')" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-times text-white text-sm"></i>
                </button>
            </div>
            <div class="legal-content overflow-y-auto text-left space-y-4 text-white/70 text-sm pr-2">
                <p><strong>Last updated: October 2024</strong></p>
                <p>Please read these terms and conditions carefully before using Our Service.</p>
                <h4 class="text-white font-semibold mt-4">1. Agreement</h4>
                <p>These Terms govern the use of this Service and the agreement between You and the Company.</p>
                <h4 class="text-white font-semibold mt-4">2. Disclaimer</h4>
                <p>The Service is provided "AS IS" without warranty of any kind.</p>
            </div>
            <div class="mt-6 pt-4 border-t border-white/10 text-center">
                <button onclick="switchModal('terms-modal', 'cookie-modal')" class="text-xs text-white/50 hover:text-white uppercase tracking-wider">Back</button>
            </div>
        </div>
    </div>

    <script>
        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            const content = modal.querySelector('.modal-content');
            
            if (modal.classList.contains('opacity-0')) {
                // Open
                modal.classList.remove('opacity-0', 'pointer-events-none');
                requestAnimationFrame(() => {
                    content.classList.remove('scale-95', 'translate-y-4');
                    content.classList.add('scale-100', 'translate-y-0');
                });
            } else {
                // Close
                content.classList.remove('scale-100', 'translate-y-0');
                content.classList.add('scale-95', 'translate-y-4');
                setTimeout(() => {
                    modal.classList.add('opacity-0', 'pointer-events-none');
                }, 300);
            }
        }

        function switchModal(closeId, openId) {
            toggleModal(closeId);
            setTimeout(() => {
                toggleModal(openId);
            }, 300);
        }
    </script>
</body>
</html>
